language: go
sudo: required
go:
  - 1.13.x
env:
  global:
    - GOPROXY=https://proxy.golang.org
    - GO111MODULE=on
    - GOARCH=amd64
    - GO_FOR_RELEASE=1.13
branches:
  only:
    - master
git:
  depth: 1
before_install:
  - mkdir -p ~/.ssh
  - openssl aes-256-cbc -K $encrypted_efc1f7a0d884_key -iv $encrypted_efc1f7a0d884_iv
    -in id_rsa.enc -out ~/.ssh/id_rsa -d
  - chmod 600 ~/.ssh/id_rsa
  - echo -e "Host douyacun\n\thostname ${hostname}\n\tport ${port}\n\tuser ${user}\n\tIdentityFile  ~/.ssh/id_rsa" > ~/.ssh/config
  - echo '149.129.67.12 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5mLOZ11Y+xqma6x6hAWSfbb6Poj+APKsIe1VLCs8FMaiXlsanSfS8tYFGpNorclRFoiNOlOuNsPzjIqkkJ+8HNxbMbpbJP//CuFhw363t7UcS2K0Xmvmw9wMy5tOTe+lywqeXmsrIaUwdA+Mgf65iqEifyddSwYLddiQ9fGE7HqxPFJ8ZwYpECKMYgAUSk1xXWskaQn4WsgrP2F35Zx7amGkRNvGT8BsliswjrPRklksq7NhqaUt5JE51Ey4ljtA0sVyGsTfTxrESsIHQSiw55lXhhk5M/fnMghnR79Tvck67V40UOdAq4yv2EXUXzrE/lfd9cUK5Gj2yLFuDc7Q9' >> ~/.ssh/known_hosts
install:
  - go version
  - go mod download
script:
  - make
deploy:
  provider: script
  script: scripts/travis.sh
  skip_cleanup: true
  on:
    tags: true